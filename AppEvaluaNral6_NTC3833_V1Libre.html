<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Evaluador NTC 3833 - Entalpia</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        /* Estilos personalizados para el efecto Netflix/Metalizado */
        body {
            background-color: #0f172a; /* Slate 900 */
            color: #e2e8f0; /* Slate 200 */
        }

        .bg-watermark {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            background-image: url('LogoEntalpia.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 500px; /* Ajusta según el tamaño deseado */
            opacity: 0.15; /* Tenue */
            pointer-events: none;
        }

        /* Scrollbar oscuro */
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b;
        }
        ::-webkit-scrollbar-thumb {
            background: #475569;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b;
        }

        /* Efecto Metálico Azul */
        .metallic-text {
            background: linear-gradient(to right, #3b82f6, #06b6d4);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .metallic-border {
            border-image: linear-gradient(to right, #3b82f6, #06b6d4) 1;
        }
        .metallic-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #0e7490 100%);
        }

        /* Inputs oscuros */
        .input-dark {
            background-color: #1e293b; /* Slate 800 */
            border: 1px solid #334155; /* Slate 700 */
            color: white;
        }
        .input-dark:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 2px rgba(59, 130, 246, 0.3);
        }
    </style>
</head>
<body class="min-h-screen relative font-sans">

    <!-- Fondo Marca de Agua -->
    <div class="bg-watermark"></div>

    <div class="max-w-5xl mx-auto p-4 md:p-8 space-y-8">
        
        <!-- Header -->
        <header class="bg-gray-800/80 backdrop-blur-md p-6 rounded-2xl shadow-2xl border-l-4 border-blue-500 relative overflow-hidden">
            <div class="absolute top-0 right-0 w-32 h-32 bg-blue-500/10 rounded-full blur-3xl pointer-events-none"></div>
            <div class="flex items-start justify-between relative z-10">
                <div>
                    <h1 class="text-3xl font-extrabold flex items-center gap-3">
                        <i data-lucide="calculator" class="w-8 h-8 text-cyan-400"></i>
                        <span class="metallic-text tracking-tight">Evaluador NTC 3833</span>
                    </h1>
                    <p class="text-slate-400 mt-2 text-sm font-medium">
                        Verificación de requisitos de localización para extremos terminales (Numeral 6).
                    </p>
                </div>
                <div class="hidden md:block">
                   <span class="bg-blue-900/50 text-cyan-300 text-xs font-bold px-3 py-1 rounded border border-blue-500/30 uppercase tracking-wider shadow-[0_0_10px_rgba(59,130,246,0.2)]">Edición Actualizada</span>
                </div>
            </div>
        </header>

        <div class="grid md:grid-cols-3 gap-8">
          
            <!-- Columna Izquierda: Configuración -->
            <div class="md:col-span-1 space-y-6">
                
                <div class="bg-gray-800/90 p-6 rounded-2xl shadow-xl border border-gray-700/50">
                    <h2 class="font-bold text-lg mb-5 flex items-center gap-2 text-white">
                        <i data-lucide="ruler" class="w-5 h-5 text-cyan-400"></i>
                        1. Tipo de Artefacto
                    </h2>
                    
                    <div class="space-y-4">
                        <label class="block text-xs font-semibold text-slate-400 uppercase tracking-wider">Seleccione Clasificación</label>
                        <select id="applianceType" class="w-full p-3 rounded-lg text-sm input-dark cursor-pointer">
                            <option value="B1_NATURAL">Tipo B.1 (Tiro Natural)</option>
                            <option value="B2_INDUCED">Tipo B.2 (Mecánico Inducido)</option>
                            <option value="B2_FORCED">Tipo B.2 (Mecánico Forzado)</option>
                            <option value="TYPE_C">Tipo C (Cámara Estanca)</option>
                        </select>

                        <!-- Input Potencia (Solo Tipo C) -->
                        <div id="powerGroup" class="hidden animate-fade-in">
                            <label class="block text-xs font-semibold text-cyan-400 mb-2 uppercase">Potencia Nominal (kW)</label>
                            <input type="number" id="power" placeholder="Ej: 14.5" class="w-full p-3 rounded-lg input-dark text-sm">
                        </div>
                    </div>

                    <div class="mt-8 pt-6 border-t border-gray-700">
                        <h3 class="text-xs font-bold text-slate-300 mb-3 uppercase tracking-wider">Condiciones Generales</h3>
                        
                        <label class="flex items-start gap-3 p-3 hover:bg-gray-700/50 rounded-lg cursor-pointer transition-colors group">
                            <input type="checkbox" id="mixedFuel" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-blue-500 focus:ring-offset-gray-800">
                            <span class="text-xs text-slate-400 leading-relaxed group-hover:text-slate-200 transition-colors">
                                ¿Se comparte el ducto con combustibles sólidos o líquidos? (Numeral 1.4)
                            </span>
                        </label>

                        <!-- Checkbox Andenes (Solo Tipo C) -->
                        <div id="walkwayGroup" class="hidden mt-2">
                             <label class="flex items-start gap-3 p-3 hover:bg-gray-700/50 rounded-lg cursor-pointer transition-colors group">
                                <input type="checkbox" id="publicWalkway" class="mt-1 w-4 h-4 rounded border-gray-600 bg-gray-700 text-blue-500 focus:ring-blue-500 focus:ring-offset-gray-800">
                                <span class="text-xs text-slate-400 leading-relaxed group-hover:text-slate-200 transition-colors">
                                    ¿Descarga sobre andén, pasaje público o vía peatonal?
                                </span>
                            </label>
                        </div>
                    </div>
                </div>

                <!-- Guía Rápida -->
                <div class="bg-blue-900/20 p-5 rounded-2xl border border-blue-500/20 text-sm text-blue-200 backdrop-blur-sm">
                   <h3 class="font-bold flex items-center gap-2 mb-3 text-cyan-400 uppercase tracking-wider text-xs">
                     <i data-lucide="book-open" class="w-4 h-4"></i> Referencia Rápida
                   </h3>
                   <div id="guideContent" class="text-xs space-y-2 opacity-80 pl-2 border-l-2 border-blue-500/30">
                       <!-- Contenido dinámico -->
                   </div>
                </div>

            </div>

            <!-- Columna Central: Datos de Medición -->
            <div class="md:col-span-2 space-y-6">
                
                <div class="bg-gray-800/90 p-6 md:p-8 rounded-2xl shadow-xl border border-gray-700/50 relative">
                    <div class="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-600 to-cyan-500 rounded-t-2xl"></div>
                    <h2 class="font-bold text-lg mb-6 text-white flex items-center gap-2">
                        2. Ingrese Mediciones en Sitio
                        <span class="text-xs font-normal text-slate-400 bg-gray-700 px-2 py-1 rounded ml-2">Metros</span>
                    </h2>
                    
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                        
                        <!-- Inputs Dinámicos -->
                        <div id="dynamicInputs" class="contents">
                            <!-- Se llenará vía JS -->
                        </div>

                    </div>
                </div>

                <!-- Resultados -->
                <div id="resultContainer" class="rounded-2xl p-6 border transition-all duration-300 bg-gray-800/50 border-gray-700">
                    <div class="flex items-center gap-4 mb-5">
                        <div id="statusIcon">
                            <i data-lucide="info" class="w-8 h-8 text-slate-500"></i>
                        </div>
                        <h2 id="statusTitle" class="text-xl font-bold text-white">
                            Esperando datos...
                        </h2>
                    </div>

                    <div id="logsContainer" class="space-y-3">
                        <p class="text-slate-500 text-sm italic">Ingrese los valores arriba para comenzar la evaluación en tiempo real.</p>
                    </div>
                </div>

            </div>
        </div>
    </div>

    <!-- JavaScript Logic -->
    <script>
        // Inicializar iconos
        lucide.createIcons();

        // Estado de la aplicación
        const state = {
            applianceType: 'B1_NATURAL',
            power: '',
            mixedFuel: false,
            publicWalkway: false,
            inputs: {
                airIntakeDist: '',
                airIntakeRadius: false,
                windowUp: '',
                windowDown: '',
                doorSide: '',
                floor: '',
                opening: ''
            }
        };

        // Referencias al DOM
        const els = {
            applianceType: document.getElementById('applianceType'),
            power: document.getElementById('power'),
            powerGroup: document.getElementById('powerGroup'),
            mixedFuel: document.getElementById('mixedFuel'),
            publicWalkway: document.getElementById('publicWalkway'),
            walkwayGroup: document.getElementById('walkwayGroup'),
            dynamicInputs: document.getElementById('dynamicInputs'),
            guideContent: document.getElementById('guideContent'),
            resultContainer: document.getElementById('resultContainer'),
            statusTitle: document.getElementById('statusTitle'),
            statusIcon: document.getElementById('statusIcon'),
            logsContainer: document.getElementById('logsContainer')
        };

        // Templates de Inputs HTML
        const templates = {
            b1_b2: `
                <div class="col-span-full bg-blue-900/10 p-4 rounded-xl border border-blue-500/20">
                    <div class="flex items-center gap-3 mb-3">
                        <label class="text-sm font-semibold text-slate-200">Bocatoma de aire forzado cercana</label>
                        <input type="checkbox" id="input_airIntakeRadius" class="w-5 h-5 rounded bg-gray-700 border-gray-600 text-cyan-500 focus:ring-cyan-500">
                        <span class="text-xs text-slate-400">¿Existe en radio &lt; 3m?</span>
                    </div>
                    <div id="airIntakeDistGroup" class="hidden mt-3 pl-8 border-l-2 border-cyan-500/30">
                        <label class="block text-xs text-cyan-400 mb-1">Distancia vertical (hacia abajo)</label>
                        <input type="number" step="0.01" id="input_airIntakeDist" class="w-full p-2 rounded input-dark text-sm placeholder-slate-600" placeholder="Metros">
                    </div>
                </div>
                ${createInputHTML('windowUp', 'Distancia a Ventana Superior')}
                ${createInputHTML('windowDown', 'Distancia a Ventana Inferior')}
                ${createInputHTML('doorSide', 'Distancia a Puerta Lateral')}
                ${createInputHTML('floor', 'Distancia al Piso del recinto')}
            `,
            b2_forced: `
                <div class="col-span-full">
                    ${createInputHTML('floor', 'Distancia vertical al nivel del suelo')}
                    <p class="text-xs text-slate-500 mt-2 italic flex items-center gap-1">
                        <i data-lucide="info" class="w-3 h-3"></i>
                        Para B.2 Forzado, verificar nota del Numeral 1.1.2.
                    </p>
                </div>
            `,
            type_c: `
                <div class="col-span-full">
                    ${createInputHTML('opening', 'Distancia a abertura de entrada de aire')}
                </div>
                <div class="col-span-full">
                    ${createInputHTML('floor', 'Altura sobre el nivel del suelo')}
                </div>
            `
        };

        function createInputHTML(id, label) {
            return `
                <div class="flex flex-col group">
                    <label class="text-xs font-bold text-slate-400 uppercase tracking-wide mb-2 group-hover:text-cyan-400 transition-colors">${label}</label>
                    <div class="relative">
                        <input type="number" step="0.01" id="input_${id}" class="w-full p-3 bg-gray-700 border border-gray-600 rounded-lg text-white focus:border-cyan-500 focus:ring-1 focus:ring-cyan-500 outline-none transition-all" placeholder="0.00">
                        <span class="absolute right-4 top-3 text-slate-500 text-xs font-bold">m</span>
                    </div>
                </div>
            `;
        }

        // Renderizado de UI
        function renderUI() {
            // Mostrar/Ocultar campos de configuración
            if (state.applianceType === 'TYPE_C') {
                els.powerGroup.classList.remove('hidden');
                els.walkwayGroup.classList.remove('hidden');
            } else {
                els.powerGroup.classList.add('hidden');
                els.walkwayGroup.classList.add('hidden');
            }

            // Renderizar Inputs de medición según tipo
            let html = '';
            if (state.applianceType === 'B1_NATURAL' || state.applianceType === 'B2_INDUCED') {
                html = templates.b1_b2;
                renderGuide(['Ventana Arriba: 1.2m', 'Ventana Abajo: 0.3m', 'Puerta Lateral: 1.2m', 'Al piso: 0.3m']);
            } else if (state.applianceType === 'B2_FORCED') {
                html = templates.b2_forced;
                renderGuide(['Al piso: 0.30 m']);
            } else if (state.applianceType === 'TYPE_C') {
                html = templates.type_c;
                renderGuide(['< 3 kW: 15 cm', '3 - 14.7 kW: 23 cm', '> 14.7 kW: 30 cm']);
            }

            els.dynamicInputs.innerHTML = html;
            
            // Re-asociar listeners a los nuevos inputs
            attachInputListeners();
            lucide.createIcons();
            
            // Restaurar valores si existen en state
            restoreInputValues();
        }

        function renderGuide(items) {
            els.guideContent.innerHTML = items.map(item => `<div class="flex items-center gap-2"><div class="w-1 h-1 bg-cyan-400 rounded-full"></div>${item}</div>`).join('');
        }

        function restoreInputValues() {
            Object.keys(state.inputs).forEach(key => {
                const input = document.getElementById(`input_${key}`);
                if (input) {
                    if (input.type === 'checkbox') input.checked = state.inputs[key];
                    else input.value = state.inputs[key];
                    
                    // Lógica especial para mostrar el input extra de bocatoma
                    if(key === 'airIntakeRadius' && state.inputs[key]) {
                        const group = document.getElementById('airIntakeDistGroup');
                        if(group) group.classList.remove('hidden');
                    }
                }
            });
        }

        function attachInputListeners() {
            const inputs = document.querySelectorAll('#dynamicInputs input');
            inputs.forEach(input => {
                input.addEventListener('input', (e) => {
                    const key = e.target.id.replace('input_', '');
                    if (e.target.type === 'checkbox') {
                        state.inputs[key] = e.target.checked;
                        // Toggle visual del input anidado
                        if (key === 'airIntakeRadius') {
                            const group = document.getElementById('airIntakeDistGroup');
                            if(group) e.target.checked ? group.classList.remove('hidden') : group.classList.add('hidden');
                        }
                    } else {
                        state.inputs[key] = e.target.value;
                    }
                    evaluate();
                });
            });
        }

        // Lógica de Evaluación (Idéntica a React)
        function evaluate() {
            let logs = [];
            let failCount = 0;

            // 1.4 Limitaciones
            if (state.mixedFuel) {
                logs.push({ status: 'fail', id: '1.4', text: 'FALLO CRÍTICO: No se permite compartir ducto con combustibles sólidos/líquidos.' });
                failCount++;
            } else {
                logs.push({ status: 'pass', id: '1.4', text: 'Sistema exclusivo para gas (Correcto).' });
            }

            // Lógica B1/B2
            if (state.applianceType === 'B1_NATURAL' || state.applianceType === 'B2_INDUCED') {
                if (state.inputs.airIntakeRadius) {
                    const val = parseFloat(state.inputs.airIntakeDist);
                    if (!isNaN(val) && val < 0.9) {
                        logs.push({ status: 'fail', id: '1.1.1', text: `Distancia a bocatoma forzada (${val}m) < 0.9m.` });
                        failCount++;
                    } else if (!isNaN(val)) {
                        logs.push({ status: 'pass', id: '1.1.1', text: 'Distancia a bocatoma forzada correcta.' });
                    }
                }

                const checks = [
                    { key: 'windowUp', min: 1.2, label: 'Ventana superior' },
                    { key: 'windowDown', min: 0.3, label: 'Ventana inferior' },
                    { key: 'doorSide', min: 1.2, label: 'Puerta lateral' },
                    { key: 'floor', min: 0.3, label: 'Piso del recinto' },
                ];

                checks.forEach(check => {
                    const val = parseFloat(state.inputs[check.key]);
                    if (!isNaN(val)) {
                        if (val < check.min) {
                            logs.push({ status: 'fail', id: '1.1.2', text: `${check.label}: ${val}m es menor al mínimo (${check.min}m).` });
                            failCount++;
                        } else {
                            logs.push({ status: 'pass', id: '1.1.2', text: `${check.label}: Cumple distancia mínima.` });
                        }
                    }
                });
            }
            // Lógica B2 Forzado
            else if (state.applianceType === 'B2_FORCED') {
                const val = parseFloat(state.inputs.floor);
                if (!isNaN(val)) {
                    if (val < 0.3) {
                        logs.push({ status: 'fail', id: 'Nota B.2', text: `Altura sobre suelo (${val}m) < 0.3m.` });
                        failCount++;
                    } else {
                        logs.push({ status: 'pass', id: 'Nota B.2', text: 'Altura sobre el suelo cumple.' });
                    }
                }
            }
            // Lógica Tipo C
            else if (state.applianceType === 'TYPE_C') {
                const pwr = parseFloat(state.power);
                const dist = parseFloat(state.inputs.opening);
                const floor = parseFloat(state.inputs.floor);

                if (!isNaN(pwr) && !isNaN(dist)) {
                    let req = 0;
                    let rule = '';
                    if (pwr < 3) { req = 0.15; rule = '1.2.1'; }
                    else if (pwr <= 14.7) { req = 0.23; rule = '1.2.2'; }
                    else { req = 0.30; rule = '1.2.3'; }

                    if (dist < req) {
                        logs.push({ status: 'fail', id: rule, text: `Para ${pwr}kW, distancia a abertura debe ser ≥ ${req}m (Actual: ${dist}m).` });
                        failCount++;
                    } else {
                        logs.push({ status: 'pass', id: rule, text: `Distancia a abertura cumple para ${pwr}kW.` });
                    }
                }

                if (!isNaN(floor)) {
                    let min = 0.3;
                    let ctx = '(Estándar)';
                    if (state.publicWalkway) { min = 2.1; ctx = '(Vía Pública)'; }

                    if (floor < min) {
                        logs.push({ status: 'fail', id: '1.2.4', text: `Altura suelo ${ctx}: ${floor}m < ${min}m.` });
                        failCount++;
                    } else {
                        logs.push({ status: 'pass', id: '1.2.4', text: `Altura suelo ${ctx} cumple.` });
                    }
                }
            }

            renderResults(logs, failCount);
        }

        function renderResults(logs, failCount) {
            const hasData = logs.length > 0;
            const isPass = failCount === 0;

            // Actualizar contenedor principal
            if (!hasData) {
                els.resultContainer.className = "rounded-2xl p-6 border transition-all duration-300 bg-gray-800/50 border-gray-700";
                els.statusTitle.innerText = "Esperando datos...";
                els.statusTitle.className = "text-xl font-bold text-slate-400";
                els.statusIcon.innerHTML = `<i data-lucide="info" class="w-8 h-8 text-slate-500"></i>`;
                els.logsContainer.innerHTML = `<p class="text-slate-500 text-sm italic">Ingrese los valores arriba para comenzar la evaluación en tiempo real.</p>`;
            } else {
                if (isPass) {
                    els.resultContainer.className = "rounded-2xl p-6 border transition-all duration-300 bg-green-900/20 border-green-500/50 shadow-[0_0_20px_rgba(34,197,94,0.1)]";
                    els.statusTitle.innerText = "Cumple Normativa";
                    els.statusTitle.className = "text-xl font-bold text-green-400";
                    els.statusIcon.innerHTML = `<i data-lucide="check-circle-2" class="w-8 h-8 text-green-500"></i>`;
                } else {
                    els.resultContainer.className = "rounded-2xl p-6 border transition-all duration-300 bg-red-900/20 border-red-500/50 shadow-[0_0_20px_rgba(239,68,68,0.1)]";
                    els.statusTitle.innerText = "No Cumple Normativa";
                    els.statusTitle.className = "text-xl font-bold text-red-400";
                    els.statusIcon.innerHTML = `<i data-lucide="x-circle" class="w-8 h-8 text-red-500"></i>`;
                }

                els.logsContainer.innerHTML = logs.map(log => `
                    <div class="p-3 rounded-lg border flex items-start gap-3 text-sm animate-fade-in ${
                        log.status === 'pass' 
                        ? 'bg-green-950/30 border-green-500/20 text-green-300' 
                        : 'bg-red-950/30 border-red-500/20 text-red-300'
                    }">
                        <div class="mt-0.5">
                            <i data-lucide="${log.status === 'pass' ? 'check-circle-2' : 'alert-triangle'}" class="w-4 h-4"></i>
                        </div>
                        <div>
                            <span class="font-bold mr-2 text-xs opacity-70 border border-current px-1 rounded">[${log.id}]</span>
                            ${log.text}
                        </div>
                    </div>
                `).join('');
            }
            lucide.createIcons();
        }

        // Listeners globales
        els.applianceType.addEventListener('change', (e) => {
            state.applianceType = e.target.value;
            // Resetear inputs al cambiar tipo para evitar confusión visual
            state.inputs = { airIntakeDist: '', airIntakeRadius: false, windowUp: '', windowDown: '', doorSide: '', floor: '', opening: '' };
            renderUI();
            evaluate();
        });

        els.power.addEventListener('input', (e) => { state.power = e.target.value; evaluate(); });
        els.mixedFuel.addEventListener('change', (e) => { state.mixedFuel = e.target.checked; evaluate(); });
        els.publicWalkway.addEventListener('change', (e) => { state.publicWalkway = e.target.checked; evaluate(); });

        // Inicialización
        renderUI();

    </script>

    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-5px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.3s ease-out forwards;
        }
    </style>
</body>
</html>