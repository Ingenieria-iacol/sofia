<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Curso Interactivo NTC 3833 | GasEngineering Hub</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- jsPDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        body { 
            background-color: #0f0f0f; 
            color: #e5e5e5;
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
        }
        
        .app-background {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%; z-index: -1;
            background-image: url('LogoEntalpia.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: 50%;
            opacity: 0.05;
            pointer-events: none;
        }

        .login-watermark {
            background-image: url('LogoEntalpia.png');
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            opacity: 0.1;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 8px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: #1a1a1a; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }
        
        .slide-enter { animation: fadeIn 0.5s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* Efecto de brillo cuando el avatar habla */
        .avatar-glow {
            box-shadow: 0 0 15px rgba(59, 130, 246, 0.6);
            border-color: #3b82f6;
        }
    </style>
</head>
<body>
    <img id="logo-entalpia" src="LogoEntalpia.png" style="display: none;" alt="Logo Entalpia" crossorigin="anonymous" />
    <div class="app-background"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const { jsPDF } = window.jspdf;

        const Icon = ({ name, size = 20, className = "" }) => {
            const iconData = lucide.icons[name];
            if (!iconData) return null;
            return (
                <svg 
                    xmlns="http://www.w3.org/2000/svg" 
                    width={size} height={size} viewBox="0 0 24 24" 
                    fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" 
                    className={className}
                    dangerouslySetInnerHTML={{ __html: iconData.map(i => `<${i[0]} ${Object.entries(i[1]).map(([k,v]) => `${k}="${v}"`).join(' ')} />`).join('') }}
                />
            );
        };

        const courseModules = [
            {
                id: 1,
                title: "Introducción Normativa",
                speech: "Hola, soy tu instructora virtual. Bienvenidos al curso de reentrenamiento. Hoy aprenderemos a valorar las particularidades de los conectores de evacuación según el Anexo C de la NTC 3833. Nuestro objetivo es lograr una puntuación positiva para garantizar la seguridad.",
                content: (
                    <div className="space-y-4">
                        <h2 className="text-2xl font-bold text-blue-400">Objetivo del Re-entrenamiento</h2>
                        <p>Este curso capacita en la aplicación del <strong>Anexo C (Informativo) de la NTC 3833</strong>.</p>
                        <div className="bg-gray-800 p-4 rounded-lg border-l-4 border-yellow-500">
                            <h3 className="font-bold text-yellow-500">Premisa de Diseño</h3>
                            <p className="text-sm mt-2">Buscamos que la suma de puntos por ganancia de cota menos las pérdidas por accesorios sea mayor o igual a +1.0 para aprobar el diseño.</p>
                        </div>
                    </div>
                ),
                quiz: {
                    q: "¿Cuál es el objetivo principal de la valoración por puntos?",
                    options: ["Calcular el precio del gas", "Garantizar la evacuación segura de humos", "Medir la temperatura del agua"],
                    correct: 1
                }
            },
            {
                id: 2,
                title: "Definiciones Clave",
                speech: "Antes de calcular, es vital entender el vocabulario. Hablaremos de Tiro Natural, que usa la física simple del aire caliente subiendo, y del Deflector, que protege esa salida.",
                content: (
                    <div className="grid grid-cols-1 gap-3 text-sm">
                        <div className="bg-[#2a2a2a] p-3 rounded border border-gray-700">
                            <strong className="text-blue-300">Tiro Natural:</strong> Movimiento de gases por diferencia de densidad (aire caliente sube).
                        </div>
                        <div className="bg-[#2a2a2a] p-3 rounded border border-gray-700">
                            <strong className="text-blue-300">Conector:</strong> Tubería que une el artefacto con la chimenea o exterior.
                        </div>
                        <div className="bg-[#2a2a2a] p-3 rounded border border-gray-700">
                            <strong className="text-blue-300">Deflector:</strong> Dispositivo en la terminal para minimizar efecto del viento.
                        </div>
                    </div>
                ),
                quiz: {
                    q: "¿Qué dispositivo minimiza el efecto del viento en la salida?",
                    options: ["El Codo", "El Deflector", "El Collarín"],
                    correct: 1
                }
            },
            {
                id: 3,
                title: "Factor de Altitud",
                speech: "Atención aquí. La altura afecta la física. En nuestro ejemplo, la presión es de 752 milibares. Al dividir esto por la presión a nivel del mar, obtenemos 0.74. Sin embargo, por seguridad, la norma ajusta el factor final a 0.6.",
                content: (
                    <div className="space-y-4">
                        <h2 className="text-xl font-bold text-green-400">Ajuste por Presión</h2>
                        <div className="flex flex-col md:flex-row gap-4 items-center justify-center my-4">
                            <div className="text-center p-3 bg-gray-800 rounded w-full border border-gray-600">
                                <div className="text-xs text-gray-400">Cálculo Real</div>
                                <div className="text-xl font-mono text-white">752 / 1013.25 = <span className="text-yellow-400">0.74</span></div>
                            </div>
                        </div>
                        <div className="bg-blue-900/30 p-4 rounded-lg text-center border border-blue-500/50">
                            <h4 className="font-bold text-blue-300">Factor de Diseño Usado</h4>
                            <p className="text-sm mt-2">Aunque el cálculo da 0.74, el ejemplo de la norma aplica un coeficiente de seguridad (aprox 0.85) resultando en:</p>
                            <p className="text-2xl font-bold text-green-400 mt-2">Factor = 0.6</p>
                            <p className="text-xs text-gray-400 mt-1">Este es el valor que usaremos para multiplicar la altura.</p>
                        </div>
                    </div>
                ),
                quiz: {
                    q: "Si el cálculo matemático da 0.74, ¿qué factor de seguridad usa el ejemplo para los cálculos?",
                    options: ["0.74", "1.0", "0.6"],
                    correct: 2
                }
            },
            {
                id: 4,
                title: "Esquema del Sistema",
                speech: "Observemos el diagrama. Tenemos una altura vertical h, un codo, y un tramo inclinado TR2. La suma de las alturas verticales nos da la H mayúscula, que es nuestra ganancia total de cota.",
                content: (
                    <div className="flex justify-center">
                        <div className="bg-white p-4 rounded-lg w-full max-w-md">
                            <svg viewBox="0 0 400 300" className="w-full h-auto">
                                <defs><pattern id="grid" width="20" height="20" patternUnits="userSpaceOnUse"><path d="M 20 0 L 0 0 0 20" fill="none" stroke="#f0f0f0" strokeWidth="1"/></pattern></defs>
                                <rect width="100%" height="100%" fill="url(#grid)" />
                                <rect x="50" y="200" width="80" height="80" fill="#e2e8f0" stroke="#475569" strokeWidth="2" />
                                <text x="90" y="245" textAnchor="middle" fill="#475569" fontSize="10" fontWeight="bold">CALENTADOR</text>
                                <line x1="90" y1="200" x2="90" y2="140" stroke="#3b82f6" strokeWidth="6" />
                                <text x="65" y="170" fill="#2563eb" fontSize="12" fontWeight="bold">h=22cm</text>
                                <path d="M 90 140 Q 90 110 120 100" stroke="#ef4444" strokeWidth="6" fill="none" />
                                <line x1="118" y1="101" x2="300" y2="40" stroke="#3b82f6" strokeWidth="6" />
                                <text x="200" y="60" fill="#2563eb" fontSize="12" fontWeight="bold" transform="rotate(-18 200,60)">TR2=245cm</text>
                                <circle cx="303" cy="40" r="8" stroke="#ef4444" strokeWidth="2" fill="white" />
                                <line x1="350" y1="200" x2="350" y2="40" stroke="#10b981" strokeWidth="1" strokeDasharray="5,5" />
                                <text x="360" y="120" fill="#10b981" fontSize="14" fontWeight="bold">H Total</text>
                            </svg>
                        </div>
                    </div>
                ),
                quiz: {
                    q: "¿Qué representa la variable H mayúscula en el diagrama?",
                    options: ["La longitud del tubo", "La ganancia total de cota (Altura vertical)", "El ancho del calentador"],
                    correct: 1
                }
            },
            {
                id: 5,
                title: "Puntos: Positivos vs Negativos",
                speech: "El sistema funciona como una balanza. La altura nos da puntos positivos porque ayuda a subir el humo. Los accesorios como codos y la longitud del tubo nos dan puntos negativos porque frenan el humo.",
                content: (
                    <div className="grid grid-cols-2 gap-4 mt-4">
                        <div className="bg-green-900/20 border border-green-800 p-4 rounded-lg text-center">
                            <Icon name="PlusCircle" className="mx-auto text-green-400 mb-2"/>
                            <h4 className="text-green-400 font-bold">Ganancia</h4>
                            <p className="text-xs mt-2">Altura (H)</p>
                            <p className="text-xs">Ayuda a evacuar</p>
                        </div>
                        <div className="bg-red-900/20 border border-red-800 p-4 rounded-lg text-center">
                            <Icon name="MinusCircle" className="mx-auto text-red-400 mb-2"/>
                            <h4 className="text-red-400 font-bold">Pérdida</h4>
                            <p className="text-xs mt-2">Codos, Longitud, Deflector</p>
                            <p className="text-xs">Frenan el flujo</p>
                        </div>
                    </div>
                ),
                quiz: {
                    q: "¿Qué efecto tienen los codos y la longitud de tubería en la valoración?",
                    options: ["Suman puntos positivos", "Restan puntos (Negativos)", "No afectan"],
                    correct: 1
                }
            },
            {
                id: 6,
                title: "Tabla de Valores",
                speech: "Aquí están los valores numéricos para nuestro ejercicio. La altura suma 0.6 puntos por cada 10 centímetros. El codo resta 2 puntos enteros. Es una penalización fuerte.",
                content: (
                    <div className="overflow-x-auto border border-gray-700 rounded-lg">
                        <table className="w-full text-xs text-left text-gray-300">
                            <thead className="uppercase bg-gray-800 text-gray-400">
                                <tr><th className="px-4 py-2">Componente</th><th className="px-4 py-2 text-right">Puntos</th></tr>
                            </thead>
                            <tbody>
                                <tr className="bg-[#1f1f1f]"><td className="px-4 py-3">Ganancia Cota (H)</td><td className="px-4 py-3 text-right text-green-400">+0.6 / 10cm</td></tr>
                                <tr className="bg-[#1a1a1a]"><td className="px-4 py-3">Deflector</td><td className="px-4 py-3 text-right text-red-400">-0.30</td></tr>
                                <tr className="bg-[#1f1f1f]"><td className="px-4 py-3">Codo Vert-Horiz</td><td className="px-4 py-3 text-right text-red-400">-2.00</td></tr>
                                <tr className="bg-[#1a1a1a]"><td className="px-4 py-3">Longitud Tubería</td><td className="px-4 py-3 text-right text-red-400">-0.5 / 100cm</td></tr>
                            </tbody>
                        </table>
                    </div>
                ),
                quiz: {
                    q: "¿Cuántos puntos se restan por el codo Vertical-Horizontal?",
                    options: ["-0.5", "-1.0", "-2.0"],
                    correct: 2
                }
            },
            {
                id: 7,
                title: "Análisis Caso Fallido",
                speech: "Analicemos el primer intento. Con una altura H de 33 centímetros, solo ganamos 1.98 puntos. Pero el codo y la longitud nos quitan más de 3 puntos. El resultado es negativo, -1.66. Esto es peligroso y se rechaza.",
                content: (
                    <div className="bg-black/40 p-4 rounded border border-red-900/50">
                        <div className="flex justify-between border-b border-gray-700 pb-2 mb-2">
                            <span>Ganancia H (33cm)</span>
                            <span className="text-green-400 font-mono">+1.98</span>
                        </div>
                        <div className="space-y-1 text-sm text-red-300">
                            <div className="flex justify-between"><span>Accesorios y Longitud</span> <span>-3.64</span></div>
                        </div>
                        <div className="flex justify-between border-t border-gray-700 pt-2 mt-2 font-bold text-lg">
                            <span>TOTAL</span>
                            <span className="text-red-500">-1.66</span>
                        </div>
                        <p className="text-center text-xs mt-2 text-red-400 uppercase font-bold">RECHAZADO (Debe ser > +1.0)</p>
                    </div>
                ),
                quiz: {
                    q: "¿Por qué se rechazó el primer diseño?",
                    options: ["El tubo era muy corto", "El puntaje total fue menor a +1.0", "El calentador era eléctrico"],
                    correct: 1
                }
            },
            {
                id: 8,
                title: "Solución: Aumentar Pendiente",
                speech: "Para arreglarlo, la Alternativa 1 sugiere inclinar más el tubo horizontal. Si subimos 45 centímetros extra, nuestra H total llega a 78. Ahora ganamos 4.68 puntos por altura, suficiente para superar las pérdidas.",
                content: (
                    <div className="space-y-4">
                        <div className="bg-green-900/10 p-3 rounded border border-green-800 text-sm">
                            <p><strong>Estrategia:</strong> Aumentar H de 33cm a 78cm.</p>
                        </div>
                        <div className="bg-black/40 p-4 rounded border border-green-900/50">
                            <div className="flex justify-between border-b border-gray-700 pb-2 mb-2">
                                <span>Nueva H (78cm)</span>
                                <span className="text-green-400 font-mono font-bold">+4.68</span>
                            </div>
                            <div className="space-y-1 text-sm text-red-300">
                                <div className="flex justify-between"><span>Pérdidas (Iguales)</span> <span>-3.64</span></div>
                            </div>
                            <div className="flex justify-between border-t border-gray-700 pt-2 mt-2 font-bold text-lg">
                                <span>NUEVO TOTAL</span>
                                <span className="text-green-500">+1.04</span>
                            </div>
                        </div>
                    </div>
                ),
                quiz: {
                    q: "¿Cuál fue la clave para aprobar en la Alternativa 1?",
                    options: ["Quitar el codo", "Aumentar la altura H (Pendiente)", "Cambiar a tubería de cobre"],
                    correct: 1
                }
            },
            {
                id: 9,
                title: "Otras Alternativas",
                speech: "Si no puedes inclinar tanto el tubo, tienes más opciones. La Alternativa 2 propone mover el calentador. La Alternativa 3 sugiere acortar distancias pero usando un tubo más ancho, de 6.5 pulgadas.",
                content: (
                    <div className="grid grid-cols-1 gap-3 text-sm">
                        <div className="bg-[#222] p-3 rounded border-l-4 border-blue-500">
                            <h4 className="font-bold text-blue-400">Alternativa 2</h4>
                            <p>Mover el calentador para lograr H=0.6m y L=2m con diámetro de 6".</p>
                        </div>
                        <div className="bg-[#222] p-3 rounded border-l-4 border-purple-500">
                            <h4 className="font-bold text-purple-400">Alternativa 3</h4>
                            <p>Reducir longitudes (H=0.5m, L=0.5m) pero aumentando diámetro a 6.5".</p>
                        </div>
                    </div>
                ),
                quiz: {
                    q: "En la Alternativa 3, al reducir la longitud, ¿qué se debe hacer con el diámetro?",
                    options: ["Reducirlo", "Dejarlo igual", "Aumentarlo a 6.5 pulgadas"],
                    correct: 2
                }
            },
            {
                id: 10,
                title: "Finalización",
                speech: "¡Felicidades! Has completado todos los módulos y aprobado las verificaciones. Ya estás listo para descargar tu constancia de reentrenamiento. Gracias por confiar en Entalpia.",
                content: (
                    <div className="text-center py-10">
                        <div className="w-20 h-20 bg-green-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg shadow-green-900/50">
                            <Icon name="Award" size={40} className="text-white" />
                        </div>
                        <h2 className="text-2xl font-bold text-white mb-2">¡Curso Completado!</h2>
                        <p className="text-gray-400 mb-6">Has demostrado dominio en la valoración de conectores NTC 3833.</p>
                    </div>
                ),
                quiz: null
            }
        ];

        function App() {
            const [currentStep, setCurrentStep] = useState(0); 
            const [completedSteps, setCompletedSteps] = useState([0]); 
            const [userName, setUserName] = useState("");
            const [userCedula, setUserCedula] = useState("");
            const [courseStarted, setCourseStarted] = useState(false);
            const [isPlaying, setIsPlaying] = useState(false);
            const [showQuiz, setShowQuiz] = useState(false);
            
            const videoRef = useRef(null); // Referencia para el video del avatar

            // Control de reproducción del video-avatar basado en el estado TTS
            useEffect(() => {
                if (videoRef.current) {
                    if (isPlaying) {
                        videoRef.current.play().catch(e => console.log("Auto-play prevented", e));
                    } else {
                        videoRef.current.pause();
                    }
                }
            }, [isPlaying]);

            // Configuración TTS (Texto a Voz) en Español
            const speak = (text) => {
                if ('speechSynthesis' in window) {
                    window.speechSynthesis.cancel();
                    const utterance = new SpeechSynthesisUtterance(text);
                    utterance.lang = 'es-ES'; // Preferencia base
                    
                    const voices = window.speechSynthesis.getVoices();
                    // Buscar voz femenina o en español de forma prioritaria
                    const spanishVoice = voices.find(v => v.lang.includes('es') && (v.name.includes('Paulina') || v.name.includes('Monica') || v.name.includes('Helena') || v.name.includes('Google') || v.name.includes('Sabina')));
                    
                    if (spanishVoice) {
                        utterance.voice = spanishVoice;
                    }

                    utterance.onstart = () => setIsPlaying(true);
                    utterance.onend = () => setIsPlaying(false);
                    utterance.onerror = () => setIsPlaying(false);
                    
                    window.speechSynthesis.speak(utterance);
                }
            };

            const stopSpeech = () => {
                window.speechSynthesis.cancel();
                setIsPlaying(false);
            };

            useEffect(() => {
                if (courseStarted && courseModules[currentStep]) {
                    setShowQuiz(false); 
                    setTimeout(() => speak(courseModules[currentStep].speech), 500);
                }
                return () => stopSpeech();
            }, [currentStep, courseStarted]);

            const handleQuizSubmit = (isCorrect) => {
                if (isCorrect) {
                    const nextStep = currentStep + 1;
                    if (!completedSteps.includes(nextStep)) {
                        setCompletedSteps([...completedSteps, nextStep]);
                    }
                    if (nextStep < courseModules.length) {
                        setCurrentStep(nextStep);
                    }
                } else {
                    alert("Respuesta incorrecta. La profesora te recomienda repasar este módulo.");
                    speak("Parece que hubo un error. Repasemos el concepto nuevamente. " + courseModules[currentStep].speech);
                    setShowQuiz(false); 
                }
            };

            const generatePDF = () => {
                const doc = new jsPDF({ orientation: "landscape", unit: "mm", format: "a4" });
                
                doc.setFillColor(240, 245, 250);
                doc.rect(0, 0, 297, 210, 'F');

                try {
                    const img = document.getElementById('logo-entalpia');
                    if (img) {
                        const canvas = document.createElement("canvas");
                        canvas.width = img.naturalWidth;
                        canvas.height = img.naturalHeight;
                        const ctx = canvas.getContext("2d");
                        ctx.drawImage(img, 0, 0);
                        const imgData = canvas.toDataURL("image/png");
                        doc.addImage(imgData, 'PNG', 100, 55, 100, (img.naturalHeight/img.naturalWidth)*100, undefined, 'FAST');
                    }
                } catch(e) {}

                doc.setLineWidth(2);
                doc.setDrawColor(20, 50, 100);
                doc.rect(10, 10, 277, 190);
                
                doc.setTextColor(20, 50, 100);
                doc.setFont("helvetica", "bold");
                doc.setFontSize(32);
                doc.text("CONSTANCIA DE RE-ENTRENAMIENTO", 148.5, 50, { align: "center" });
                
                doc.setFontSize(18);
                doc.setTextColor(60, 60, 60);
                doc.text("GasEngineering Hub certifica que:", 148.5, 75, { align: "center" });
                
                doc.setFontSize(26);
                doc.setTextColor(0, 0, 0);
                doc.text(userName.toUpperCase(), 148.5, 90, { align: "center" });
                
                doc.setFontSize(14);
                doc.setTextColor(80, 80, 80);
                doc.text(`ID / C.C. ${userCedula}`, 148.5, 100, { align: "center" });
                
                doc.setFontSize(16);
                doc.setTextColor(60, 60, 60);
                doc.text("Ha aprobado satisfactoriamente los 10 módulos del curso técnico:", 148.5, 120, { align: "center" });
                
                doc.setFont("helvetica", "bold");
                doc.setFontSize(20);
                doc.text("NTC 3833 Anexo C: Evacuación en Fachada", 148.5, 135, { align: "center" });
                
                doc.setFontSize(12);
                doc.setTextColor(100, 100, 100);
                doc.text("Con el respaldo técnico y académico de ENTALPIA", 148.5, 175, { align: "center" });

                doc.save(`Certificado_Entalpia_${userName}.pdf`);
            };

            if (!courseStarted) {
                return (
                    <div className="min-h-screen flex items-center justify-center p-4 relative overflow-hidden">
                         <div className="absolute inset-0 login-watermark z-0"></div>
                         <div className="bg-[#1a1a1a]/95 backdrop-blur-md p-8 rounded-2xl shadow-2xl max-w-md w-full border border-gray-700 relative z-10">
                            <div className="w-16 h-16 bg-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 shadow-lg shadow-blue-500/30">
                                <Icon name="BookOpen" size={32} className="text-white" />
                            </div>
                            <h1 className="text-2xl font-bold text-center mb-2">Bienvenido a Entalpia</h1>
                            <p className="text-center text-gray-400 text-sm mb-6">Plataforma de Re-entrenamiento NTC 3833</p>
                            
                            <div className="space-y-4">
                                <div>
                                    <label className="block text-xs text-gray-400 mb-1 ml-1">Nombre Completo</label>
                                    <input type="text" className="w-full bg-[#0f0f0f] border border-gray-600 rounded p-3 focus:border-blue-500 outline-none" 
                                        value={userName} onChange={e => setUserName(e.target.value)} />
                                </div>
                                <div>
                                    <label className="block text-xs text-gray-400 mb-1 ml-1">Cédula de Ciudadanía</label>
                                    <input type="number" className="w-full bg-[#0f0f0f] border border-gray-600 rounded p-3 focus:border-blue-500 outline-none" 
                                        value={userCedula} onChange={e => setUserCedula(e.target.value)} />
                                </div>
                                <button 
                                    onClick={() => (userName.length > 3 && userCedula.length > 4) ? setCourseStarted(true) : alert("Completa tus datos")}
                                    className="w-full bg-blue-600 hover:bg-blue-500 py-3 rounded font-bold transition-all shadow-lg mt-2"
                                >
                                    Ingresar al Curso
                                </button>
                            </div>
                         </div>
                    </div>
                );
            }

            const activeModule = courseModules[currentStep];

            return (
                <div className="flex h-screen overflow-hidden">
                    {/* SIDEBAR */}
                    <aside className="w-72 bg-[#111] border-r border-gray-800 hidden md:flex flex-col z-20">
                        <div className="p-6 border-b border-gray-800 flex items-center gap-2">
                            <div className="w-8 h-8 bg-blue-600 rounded flex items-center justify-center font-bold">E</div>
                            <span className="font-bold text-lg">Entalpia<span className="text-blue-500">Edu</span></span>
                        </div>
                        <div className="flex-1 overflow-y-auto p-4 space-y-2">
                            {courseModules.map((mod, idx) => {
                                const isUnlocked = completedSteps.includes(idx);
                                const isCurrent = idx === currentStep;
                                const isCompleted = completedSteps.includes(idx + 1);

                                return (
                                    <div key={mod.id} 
                                        className={`p-3 rounded-lg text-sm flex items-center gap-3 transition-all ${isCurrent ? 'bg-blue-900/30 border border-blue-600/50' : 'bg-transparent'} ${!isUnlocked ? 'opacity-50 cursor-not-allowed' : ''}`}
                                    >
                                        <div className={`w-6 h-6 rounded-full flex items-center justify-center flex-shrink-0 text-xs font-bold ${isCompleted ? 'bg-green-500 text-white' : isCurrent ? 'bg-blue-500 text-white' : 'bg-gray-700'}`}>
                                            {isCompleted ? <Icon name="Check" size={14} /> : idx + 1}
                                        </div>
                                        <div className="flex-1 truncate">{mod.title}</div>
                                        {!isUnlocked && <Icon name="Lock" size={14} className="text-gray-500" />}
                                    </div>
                                )
                            })}
                        </div>
                        <div className="p-4 bg-[#0a0a0a] border-t border-gray-800 text-xs text-gray-400">
                            Estudiante: <span className="text-white block font-bold text-sm truncate">{userName}</span>
                        </div>
                    </aside>

                    {/* MAIN CONTENT */}
                    <main className="flex-1 flex flex-col relative z-10 bg-[#0f0f0f]/90">
                        {/* Header */}
                        <header className="p-4 border-b border-gray-800 flex justify-between items-center bg-[#111]">
                            <h2 className="font-bold text-lg text-white truncate">{activeModule.title}</h2>
                            <div className="flex items-center gap-3">
                                {/* AVATAR DE VIDEO DINÁMICO */}
                                <div className={`relative w-12 h-12 rounded-full overflow-hidden border-2 flex-shrink-0 bg-gray-800 ${isPlaying ? 'border-blue-500 avatar-glow' : 'border-gray-600'}`}>
                                    <video 
                                        ref={videoRef}
                                        src="VideoSaberMas.mp4" 
                                        className="w-full h-full object-cover" 
                                        muted 
                                        playsInline 
                                        loop
                                    />
                                </div>
                                
                                <div className="text-xs hidden sm:block">
                                    <div className="font-bold text-gray-200">Ing. Ana</div>
                                    <div className="text-[10px] text-blue-400">{isPlaying ? "Explicando..." : "Instructora Virtual"}</div>
                                </div>
                                <button onClick={() => isPlaying ? stopSpeech() : speak(activeModule.speech)} className="ml-2 hover:text-white text-gray-400">
                                    <Icon name={isPlaying ? "PauseCircle" : "PlayCircle"} size={20} />
                                </button>
                            </div>
                        </header>

                        {/* Content Area */}
                        <div className="flex-1 overflow-y-auto p-6 md:p-10 custom-scrollbar flex flex-col items-center">
                            <div className="max-w-3xl w-full slide-enter key={currentStep}">
                                
                                <div className={`transition-all duration-500 ${showQuiz ? 'opacity-50 pointer-events-none blur-sm hidden' : 'opacity-100'}`}>
                                    {activeModule.content}
                                    
                                    <div className="mt-8 flex justify-end">
                                        {activeModule.quiz ? (
                                            <button 
                                                onClick={() => { stopSpeech(); setShowQuiz(true); }}
                                                className="bg-blue-600 hover:bg-blue-500 text-white px-6 py-3 rounded-lg font-bold flex items-center gap-2 shadow-lg animate-bounce"
                                            >
                                                Realizar Validación <Icon name="ArrowRight" size={18} />
                                            </button>
                                        ) : (
                                            <button 
                                                onClick={generatePDF}
                                                className="bg-green-600 hover:bg-green-500 text-white px-6 py-3 rounded-lg font-bold flex items-center gap-2 shadow-lg"
                                            >
                                                Descargar Certificado <Icon name="Download" size={18} />
                                            </button>
                                        )}
                                    </div>
                                </div>

                                {/* Quiz Overlay */}
                                {showQuiz && activeModule.quiz && (
                                    <div className="mt-8 bg-gray-800 p-6 rounded-xl border border-blue-500/30 shadow-2xl slide-enter">
                                        <div className="flex items-center gap-2 mb-4 text-blue-400">
                                            <Icon name="HelpCircle" />
                                            <span className="font-bold uppercase text-xs tracking-wider">Pregunta de control</span>
                                        </div>
                                        <h3 className="text-xl font-bold text-white mb-6">{activeModule.quiz.q}</h3>
                                        <div className="space-y-3">
                                            {activeModule.quiz.options.map((opt, idx) => (
                                                <button 
                                                    key={idx}
                                                    onClick={() => handleQuizSubmit(idx === activeModule.quiz.correct)}
                                                    className="w-full text-left p-4 rounded-lg bg-[#1a1a1a] border border-gray-700 hover:border-blue-500 hover:bg-gray-750 transition-all flex justify-between group"
                                                >
                                                    <span>{opt}</span>
                                                    <Icon name="ChevronRight" className="opacity-0 group-hover:opacity-100 text-blue-500 transition-opacity" />
                                                </button>
                                            ))}
                                        </div>
                                        <button onClick={() => setShowQuiz(false)} className="mt-4 text-sm text-gray-500 underline hover:text-gray-300">
                                            Volver al contenido
                                        </button>
                                    </div>
                                )}

                            </div>
                        </div>
                    </main>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>